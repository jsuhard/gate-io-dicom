#=========================================================
#
# Replace ITKConfig.cmake from external installation of ITK.
# Load requested modules and their dependencies into variables:
#  ITK_LIBRARIES       = Libraries to link
#  ITK_INCLUDE_DIRS    = Header file search path
#  ITK_LIBRARY_DIRS    = Library search path (for outside dependencies)

CMAKE_MINIMUM_REQUIRED (VERSION 2.4)
PROJECT(ITK)

SET(ITK_LIBRARY_DIRS ${PROJECT_BINARY_DIR})
SET(ITK_INCLUDE_DIRS ${PROJECT_BINARY_DIR} ${PROJECT_SOURCE_DIR})
INCLUDE_DIRECTORIES(${ITK_INCLUDE_DIRS})

SET(ITK_INSTALL_BIN_DIR_CM24 ${PROJECT_BINARY_DIR})
SET(ITK_INSTALL_LIB_DIR_CM24 ${PROJECT_BINARY_DIR})
SET(ITK_INSTALL_INCLUDE_DIR_CM24 ${PROJECT_BINARY_DIR})
SET(ITK_INSTALL_NO_LIBRARIES ON)
SET(ITK_INSTALL_NO_DEVELOPMENT ON)

#=========================================================
# MetaIO
ADD_SUBDIRECTORY(itkzlib)
ADD_SUBDIRECTORY(MetaIO)
LIST(APPEND ITK_LIBRARIES ITKMetaIO itkzlib)
LIST(APPEND ITK_LIBRARY_DIRS ${PROJECT_BINARY_DIR}/itkzlib ${PROJECT_BINARY_DIR}/MetaIO)
LIST(APPEND ITK_INCLUDE_DIRS ${PROJECT_SOURCE_DIR}/itkzlib ${PROJECT_SOURCE_DIR}/MetaIO)
# ADD_EXECUTABLE(testmhd testmhd.cxx)
# TARGET_LINK_LIBRARIES(testmhd ${ITK_LIBRARIES})
#=========================================================

#=========================================================
# OpenJPEG
INCLUDE (${CMAKE_ROOT}/Modules/TestBigEndian.cmake)
TEST_BIG_ENDIAN(CMAKE_WORDS_BIGENDIAN)
ADD_SUBDIRECTORY(openjpeg)
LIST(APPEND ITK_LIBRARY_DIRS ${PROJECT_BINARY_DIR}/openjpeg)
SET(ITKOpenJPEG_INCLUDE_DIRS ${PROJECT_SOURCE_DIR}/openjpeg ${PROJECT_BINARY_DIR}/openjpeg)
INCLUDE_DIRECTORIES(${ITKOpenJPEG_INCLUDE_DIRS})
SET(ITKOpenJPEG_LIBRARIES openjpeg)
#=========================================================

#=========================================================
# GDCM
# Using "system" libraries
#
# Expat:
SET(GDCM_USE_SYSTEM_EXPAT ON CACHE INTERNAL "")
#SET(EXPAT_INCLUDE_DIR ${ITKExpat_INCLUDE_DIRS})
#SET(EXPAT_LIBRARY ${ITKExpat_LIBRARIES})
# OpenJPEG:
SET(GDCM_USE_SYSTEM_OPENJPEG ON CACHE INTERNAL "")
SET(OPENJPEG_MAJOR_VERSION 2)
SET(OPENJPEG_LIBRARY ${ITKOpenJPEG_LIBRARIES})
SET(OPENJPEG_LIBRARIES ${OPENJPEG_LIBRARY})
SET(OPENJPEG_INCLUDE_DIR ${ITKOpenJPEG_INCLUDE_DIRS})
# ZLIB:
SET(GDCM_USE_SYSTEM_ZLIB ON CACHE INTERNAL "")
#SET(ZLIB_INCLUDE_DIR ${ITKZLIB_INCLUDE_DIRS})
#SET(ZLIB_LIBRARY ${ITKZLIB_LIBRARIES})

# Configure GDCM privately so its options do not appear to the user.
SET(GDCM_LEGACY_REMOVE OFF CACHE INTERNAL "Remove all legacy code completely.")
SET(GDCM_LEGACY_SILENT OFF CACHE INTERNAL "Silence all legacy code messages.")
SET(GDCM_SUPPORT_BROKEN_IMPLEMENTATION ON CACHE INTERNAL "Handle broken DICOM")
SET(GDCM_USE_KAKADU OFF CACHE INTERNAL "Use kakadu lib, only turn it on if you know what you are doing.")
SET(GDCM_USE_PVRG OFF CACHE INTERNAL "Use pvrg lib, only turn it on if you know what you are doing.")
SET(GDCM_USE_SYSTEM_LJPEG OFF CACHE INTERNAL "Use system ljpeg (ijg lib)")
SET(GDCM_USE_SYSTEM_OPENSSL OFF CACHE INTERNAL "Use system OpenSSL")
SET(GDCM_USE_SYSTEM_PODOFO OFF CACHE INTERNAL "Use system podofo (pdf)")
SET(GDCM_USE_SYSTEM_POPPLER OFF CACHE INTERNAL "Use system poppler (pdf)")
SET(GDCM_USE_SYSTEM_UUID OFF CACHE INTERNAL "Use system uuid")
SET(GDCM_USE_WXWIDGETS OFF CACHE INTERNAL "wxWidgets bridge ?")
SET(GDCM_WRITE_ODD_LENGTH OFF CACHE INTERNAL "Do not change")
SET(GDCM_TARGETS_NAME GDCMTargets)
SET(GDCM_INSTALL_DATA_DIR "${PROJECT_BINARY_DIR}/share") # XML
SET(GDCM_INSTALL_NO_DEVELOPMENT ON)
SET(JPEG_INSTALL_NO_DEVELOPMENT ON)
SET(GDCM_INSTALL_NO_RUNTIME ON)
SET(GDCM_INSTALL_NO_LIBRARIES ON)
SET(GDCM_INSTALL_NO_DOCUMENTATION ON)
# GDCM uses these to refer to executable and library locations
SET(EXECUTABLE_OUTPUT_PATH ${PROJECT_BINARY_DIR})
SET(LIBRARY_OUTPUT_PATH ${PROJECT_BINARY_DIR})

ADD_SUBDIRECTORY(gdcm)
LIST(APPEND ITK_LIBRARIES gdcmCommon gdcmDSED gdcmMSFF gdcmjpeg12 gdcmjpeg8 gdcmDICT gdcmIOD gdcmjpeg16 gdcmuuid)
LIST(APPEND ITK_INCLUDE_DIRS
${PROJECT_BINARY_DIR}/gdcm/Source/Common
${PROJECT_SOURCE_DIR}/gdcm/Source/MediaStorageAndFileFormat
${PROJECT_SOURCE_DIR}/gdcm/Source/DataDictionary
${PROJECT_SOURCE_DIR}/gdcm/Source/Common
${PROJECT_SOURCE_DIR}/gdcm/Source/InformationObjectDefinition
${PROJECT_SOURCE_DIR}/gdcm/Source/MessageExchangeDefinition
${PROJECT_SOURCE_DIR}/gdcm/Source/DataStructureAndEncodingDefinition)
#=========================================================

SET(ITK_LIBRARIES ${ITK_LIBRARIES} PARENT_SCOPE)
SET(ITK_LIBRARY_DIRS ${ITK_LIBRARY_DIRS} PARENT_SCOPE)
SET(ITK_INCLUDE_DIRS ${ITK_INCLUDE_DIRS} PARENT_SCOPE)
